<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>USMC Convoy Manifest Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; text-align: center; height: 100vh; overflow: hidden; }
        #splash { background-color: white; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #splash img { max-width: 300px; width: 80%; }
        #app { display: none; height: 100vh; overflow-y: auto; }
        h1 { color: #013220; }
        .screen { padding: 20px; max-width: 800px; margin: 0 auto; background: white; min-height: 100%; }
        button { background-color: #013220; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #024930; }
        button:disabled { background-color: #666; cursor: not-allowed; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        label { display: block; margin: 5px 0; font-weight: bold; }
        .search-container { display: flex; align-items: center; margin-bottom: 20px; }
        #comm-search, #water-search, #fuel-search { flex: 1; }
        #add-search-btn, #add-water-btn, #add-fuel-btn { margin-left: 10px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #013220; color: white; }
        #comm-gear-added, #water-container-added, #fuel-container-added { max-height: 400px; overflow-y: auto; }
        .delete-btn { background-color: #a30000; padding: 5px 10px; }
        .delete-btn:hover { background-color: #cc0000; }
        .error-message { color: red; font-size: 12px; display: none; }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Eagle%2C_Globe%2C_and_Anchor.svg/512px-Eagle%2C_Globe%2C_and_Anchor.svg.png" alt="USMC EGA">
        <h1>USMC Convoy Manifest Tool</h1>
        <p>Developed by [Your Name]</p>
    </div>

    <!-- Main App -->
    <div id="app">
        <!-- Initial Screen -->
        <div id="initial-screen" class="screen">
            <h1>Welcome to the USMC Convoy Manifest Tool</h1>
            <button id="new-user-btn">New User</button>
            <button id="returning-user-btn" disabled>Returning User</button>
        </div>

        <!-- New User Registration -->
        <div id="new-user-screen" class="screen" style="display: none;">
            <h1>New User Registration</h1>
            <form id="user-form">
                <label for="rank">Rank:</label>
                <input type="text" id="rank" name="rank" required>
                <label for="last-name">Last Name:</label>
                <input type="text" id="last-name" name="last-name" required>
                <label for="first-name">First Name:</label>
                <input type="text" id="first-name" name="first-name" required>
                <label for="billet">Billet:</label>
                <input type="text" id="billet" name="billet" required>
                <label for="unit">Unit:</label>
                <input type="text" id="unit" name="unit" required>
                <button type="submit">Submit</button>
            </form>
        </div>

        <!-- Options Screen -->
        <div id="options-screen" class="screen" style="display: none;">
            <h1>Convoy Management Options</h1>
            <button id="enter-vehicles-btn">Enter New Vehicles</button>
            <button id="enter-personnel-btn">Enter New Personnel</button>
            <button id="back-to-initial-btn">Back</button>
        </div>

        <!-- Enter Vehicles Screen -->
        <div id="vehicles-screen" class="screen" style="display: none;">
            <h1>Enter New Vehicles</h1>
            <button id="manual-add-btn">Manual Add</button>
            <button id="upload-spreadsheet-btn">Upload Spreadsheet</button>
            <button id="back-to-options-btn">Back</button>
        </div>

        <!-- Manual Add Screen -->
        <div id="manual-add-screen" class="screen" style="display: none;">
            <h1>Manual Add Equipment</h1>
            <button id="add-comm-gear-btn">Add Comm Gear</button>
            <button id="add-water-containers-btn">Add Water Containers</button>
            <button id="add-fuel-containers-btn">Add Fuel Containers</button>
            <button id="add-vehicles-btn">Add Vehicles</button>
            <button id="add-weapons-btn">Add Weapons Systems</button>
            <button id="back-to-vehicles-btn">Back</button>
        </div>

        <!-- Add Comm Gear Screen (Input Style 2) -->
        <div id="add-comm-gear-screen" class="screen" style="display: none;">
            <h1>Add Comm Gear (Input Style 2)</h1>
            <div class="search-container">
                <input type="text" id="comm-search" placeholder="Search Radio Type" list="comm-suggestions">
                <datalist id="comm-suggestions"></datalist>
                <button id="add-search-btn">Add</button>
            </div>
            <table id="comm-gear-table">
                <thead>
                    <tr>
                        <th>Radio Type</th>
                        <th>Serial Number</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="comm-gear-added"></tbody>
            </table>
            <button id="save-comm-gear-btn">Save</button>
            <button id="back-to-manual-add-btn">Back</button>
        </div>

        <!-- Add Water Containers Screen (Input Style 2) -->
        <div id="add-water-containers-screen" class="screen" style="display: none;">
            <h1>Add Water Containers (Input Style 2)</h1>
            <div class="search-container">
                <input type="text" id="water-search" placeholder="Search Water Container" list="water-suggestions">
                <datalist id="water-suggestions"></datalist>
                <button id="add-water-btn">Add</button>
            </div>
            <table id="water-container-table">
                <thead>
                    <tr>
                        <th>Container Code</th>
                        <th>Name</th>
                        <th>Serial Number</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="water-container-added"></tbody>
            </table>
            <button id="save-water-btn">Save</button>
            <button id="back-to-manual-add-btn-water">Back</button>
        </div>

        <!-- Add Fuel Containers Screen (Input Style 2) -->
        <div id="add-fuel-containers-screen" class="screen" style="display: none;">
            <h1>Add Fuel Containers (Input Style 2)</h1>
            <div class="search-container">
                <input type="text" id="fuel-search" placeholder="Search Fuel Container" list="fuel-suggestions">
                <datalist id="fuel-suggestions"></datalist>
                <button id="add-fuel-btn">Add</button>
            </div>
            <table id="fuel-container-table">
                <thead>
                    <tr>
                        <th>Container Code</th>
                        <th>Name</th>
                        <th>Serial Number</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="fuel-container-added"></tbody>
            </table>
            <button id="save-fuel-btn">Save</button>
            <button id="back-to-manual-add-btn-fuel">Back</button>
        </div>
    </div>

    <script>
        // Radio types for Comm Gear
        const radioTypes = [
            "AN/PRC-117F",
            "AN/PRC-117G",
            "AN/PRC-148 (MBITR)",
            "AN/PRC-150",
            "AN/PRC-152",
            "AN/PRC-154",
            "AN/PRC-155",
            "AN/PRC-163",
            "(MIDS) JTRS",
            "AN/PRC-119",
            "AN/PRC-153 (IISR)"
        ];

        // Water container data
        const waterContainerData = {
            "B2086": "SIXCON Water Storage Module",
            "D0880": "M149 Water Trailer ('Water Bull')",
            "D0882": "MTVR Water Trailer (MK149)"
        };

        // Fuel container data from your table
        const fuelContainerData = {
            "B2085": "Fuel SIXCON",
            "D0211": "Flatrack Refueler",
            "D0215": "M970 Refueler"
        };

        // Screen management
        function showScreen(screenId) {
            document.querySelectorAll('#app .screen').forEach(screen => screen.style.display = 'none');
            document.getElementById(screenId).style.display = 'block';
        }

        // Splash screen transition
        setTimeout(() => {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('app').style.display = 'block';
        }, 5000);

        // Check for existing data
        const userData = JSON.parse(localStorage.getItem('userData')) || {};
        const commGear = JSON.parse(localStorage.getItem('commGear')) || [];
        const waterContainers = JSON.parse(localStorage.getItem('waterContainers')) || [];
        const fuelContainers = JSON.parse(localStorage.getItem('fuelContainers')) || [];
        if (Object.keys(userData).length > 0 || commGear.length > 0 || waterContainers.length > 0 || fuelContainers.length > 0) {
            document.getElementById('returning-user-btn').disabled = false;
        }

        // Initial screen buttons
        document.getElementById('new-user-btn').addEventListener('click', () => showScreen('new-user-screen'));
        document.getElementById('returning-user-btn').addEventListener('click', () => alert('Returning user functionality coming soon!'));

        // New user form submission
        document.getElementById('user-form').addEventListener('submit', (event) => {
            event.preventDefault();
            const user = {
                rank: document.getElementById('rank').value,
                lastName: document.getElementById('last-name').value,
                firstName: document.getElementById('first-name').value,
                billet: document.getElementById('billet').value,
                unit: document.getElementById('unit').value
            };
            localStorage.setItem('userData', JSON.stringify(user));
            showScreen('options-screen');
        });

        // Options screen buttons
        document.getElementById('enter-vehicles-btn').addEventListener('click', () => showScreen('vehicles-screen'));
        document.getElementById('enter-personnel-btn').addEventListener('click', () => alert('Personnel entry coming soon!'));
        document.getElementById('back-to-initial-btn').addEventListener('click', () => showScreen('initial-screen'));

        // Vehicles screen buttons
        document.getElementById('manual-add-btn').addEventListener('click', () => showScreen('manual-add-screen'));
        document.getElementById('upload-spreadsheet-btn').addEventListener('click', () => alert('Spreadsheet upload coming soon!'));
        document.getElementById('back-to-options-btn').addEventListener('click', () => showScreen('options-screen'));

        // Manual add screen buttons
        document.getElementById('add-comm-gear-btn').addEventListener('click', () => {
            showScreen('add-comm-gear-screen');
            loadCommGearRows();
        });
        document.getElementById('add-water-containers-btn').addEventListener('click', () => {
            showScreen('add-water-containers-screen');
            loadWaterContainerRows();
        });
        document.getElementById('add-fuel-containers-btn').addEventListener('click', () => {
            showScreen('add-fuel-containers-screen');
            loadFuelContainerRows();
        });
        document.getElementById('add-vehicles-btn').addEventListener('click', () => alert('Add Vehicles form coming soon!'));
        document.getElementById('add-weapons-btn').addEventListener('click', () => alert('Add Weapons Systems form coming soon!'));
        document.getElementById('back-to-vehicles-btn').addEventListener('click', () => showScreen('vehicles-screen'));

        // Comm Gear (Input Style 2) logic
        const commSearchInput = document.getElementById('comm-search');
        const commSuggestions = document.getElementById('comm-suggestions');
        const commAddedTable = document.getElementById('comm-gear-added');

        radioTypes.forEach(type => {
            commSuggestions.innerHTML += `<option value="${type}"></option>`;
        });

        document.getElementById('add-search-btn').addEventListener('click', () => {
            const query = commSearchInput.value.trim().toUpperCase();
            const match = radioTypes.find(type => type.toUpperCase() === query);
            if (match) {
                commAddedTable.appendChild(createCommGearRow(match));
                commSearchInput.value = '';
            } else {
                alert('No matching radio type found. Please select from the suggestions.');
            }
        });

        function createCommGearRow(radioType, serial = '') {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${radioType}</td>
                <td>
                    <input type="text" class="serial-input" value="${serial}" placeholder="Enter Serial Number" required>
                    <div class="error-message">Missing Serial Number</div>
                </td>
                <td><button class="delete-btn">Delete</button></td>
            `;
            row.querySelector('.delete-btn').addEventListener('click', () => {
                row.remove();
            });
            return row;
        }

        function loadCommGearRows() {
            commAddedTable.innerHTML = '';
            const savedGear = JSON.parse(localStorage.getItem('commGear')) || [];
            savedGear.forEach(gear => commAddedTable.appendChild(createCommGearRow(gear.radioType, gear.serial)));
        }

        document.getElementById('save-comm-gear-btn').addEventListener('click', () => {
            const rows = commAddedTable.querySelectorAll('tr');
            const gearList = [];
            let allValid = true;
            rows.forEach(row => {
                const radioType = row.cells[0].textContent;
                const serialInput = row.querySelector('.serial-input');
                const serial = serialInput.value.trim();
                const errorMessage = row.querySelector('.error-message');
                if (serial) {
                    gearList.push({ radioType, serial });
                    errorMessage.style.display = 'none';
                } else {
                    allValid = false;
                    errorMessage.style.display = 'block';
                }
            });
            if (!allValid) {
                alert('Please enter serial numbers for all added items.');
            } else if (gearList.length > 0) {
                localStorage.setItem('commGear', JSON.stringify(gearList));
                alert('Comm Gear saved!');
                showScreen('manual-add-screen');
            } else {
                alert('No items to save.');
            }
        });

        // Water Containers (Input Style 2) logic
        const waterSearchInput = document.getElementById('water-search');
        const waterSuggestions = document.getElementById('water-suggestions');
        const waterAddedTable = document.getElementById('water-container-added');

        Object.entries(waterContainerData).forEach(([code, name]) => {
            waterSuggestions.innerHTML += `<option value="${code}">${name}</option>`;
        });

        document.getElementById('add-water-btn').addEventListener('click', () => {
            const query = waterSearchInput.value.trim().toUpperCase();
            const match = Object.keys(waterContainerData).find(code => code === query) || 
                         Object.values(waterContainerData).find(name => name.toUpperCase() === query);
            const code = Object.keys(waterContainerData).find(c => waterContainerData[c] === match || c === query);
            const name = waterContainerData[code];
            if (code && name) {
                waterAddedTable.appendChild(createWaterContainerRow(code, name));
                waterSearchInput.value = '';
            } else {
                alert('No matching water container found. Please select from the suggestions.');
            }
        });

        function createWaterContainerRow(code, name, serial = '') {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${code}</td>
                <td>${name}</td>
                <td>
                    <input type="text" class="serial-input" value="${serial}" placeholder="Enter Serial Number" required>
                    <div class="error-message">Missing Serial Number</div>
                </td>
                <td><button class="delete-btn">Delete</button></td>
            `;
            row.querySelector('.delete-btn').addEventListener('click', () => {
                row.remove();
            });
            return row;
        }

        function loadWaterContainerRows() {
            waterAddedTable.innerHTML = '';
            const savedContainers = JSON.parse(localStorage.getItem('waterContainers')) || [];
            savedContainers.forEach(container => waterAddedTable.appendChild(createWaterContainerRow(container.code, container.name, container.serial)));
        }

        document.getElementById('save-water-btn').addEventListener('click', () => {
            const rows = waterAddedTable.querySelectorAll('tr');
            const containerList = [];
            let allValid = true;
            rows.forEach(row => {
                const code = row.cells[0].textContent;
                const name = row.cells[1].textContent;
                const serialInput = row.querySelector('.serial-input');
                const serial = serialInput.value.trim();
                const errorMessage = row.querySelector('.error-message');
                if (serial) {
                    containerList.push({ code, name, serial });
                    errorMessage.style.display = 'none';
                } else {
                    allValid = false;
                    errorMessage.style.display = 'block';
                }
            });
            if (!allValid) {
                alert('Please enter serial numbers for all added items.');
            } else if (containerList.length > 0) {
                localStorage.setItem('waterContainers', JSON.stringify(containerList));
                alert('Water Containers saved!');
                showScreen('manual-add-screen');
            } else {
                alert('No items to save.');
            }
        });

        // Fuel Containers (Input Style 2) logic
        const fuelSearchInput = document.getElementById('fuel-search');
        const fuelSuggestions = document.getElementById('fuel-suggestions');
        const fuelAddedTable = document.getElementById('fuel-container-added');

        Object.entries(fuelContainerData).forEach(([code, name]) => {
            fuelSuggestions.innerHTML += `<option value="${code}">${name}</option>`;
        });

        document.getElementById('add-fuel-btn').addEventListener('click', () => {
            const query = fuelSearchInput.value.trim().toUpperCase();
            const match = Object.keys(fuelContainerData).find(code => code === query) || 
                         Object.values(fuelContainerData).find(name => name.toUpperCase() === query);
            const code = Object.keys(fuelContainerData).find(c => fuelContainerData[c] === match || c === query);
            const name = fuelContainerData[code];
            if (code && name) {
                fuelAddedTable.appendChild(createFuelContainerRow(code, name));
                fuelSearchInput.value = '';
            } else {
                alert('No matching fuel container found. Please select from the suggestions.');
            }
        });

        function createFuelContainerRow(code, name, serial = '') {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${code}</td>
                <td>${name}</td>
                <td>
                    <input type="text" class="serial-input" value="${serial}" placeholder="Enter Serial Number" required>
                    <div class="error-message">Missing Serial Number</div>
                </td>
                <td><button class="delete-btn">Delete</button></td>
            `;
            row.querySelector('.delete-btn').addEventListener('click', () => {
                row.remove();
            });
            return row;
        }

        function loadFuelContainerRows() {
            fuelAddedTable.innerHTML = '';
            const savedContainers = JSON.parse(localStorage.getItem('fuelContainers')) || [];
            savedContainers.forEach(container => fuelAddedTable.appendChild(createFuelContainerRow(container.code, container.name, container.serial)));
        }

        document.getElementById('save-fuel-btn').addEventListener('click', () => {
            const rows = fuelAddedTable.querySelectorAll('tr');
            const containerList = [];
            let allValid = true;
            rows.forEach(row => {
                const code = row.cells[0].textContent;
                const name = row.cells[1].textContent;
                const serialInput = row.querySelector('.serial-input');
                const serial = serialInput.value.trim();
                const errorMessage = row.querySelector('.error-message');
                if (serial) {
                    containerList.push({ code, name, serial });
                    errorMessage.style.display = 'none';
                } else {
                    allValid = false;
                    errorMessage.style.display = 'block';
                }
            });
            if (!allValid) {
                alert('Please enter serial numbers for all added items.');
            } else if (containerList.length > 0) {
                localStorage.setItem('fuelContainers', JSON.stringify(containerList));
                alert('Fuel Containers saved!');
                showScreen('manual-add-screen');
            } else {
                alert('No items to save.');
            }
        });

        document.getElementById('back-to-manual-add-btn-water').addEventListener('click', () => showScreen('manual-add-screen'));
        document.getElementById('back-to-manual-add-btn-fuel').addEventListener('click', () => showScreen('manual-add-screen'));
        document.getElementById('back-to-manual-add-btn').addEventListener('click', () => showScreen('manual-add-screen'));
    </script>
</body>
</html>
